DROP USER ersproject CASCADE;


CREATE USER ersproject
IDENTIFIED BY ers0
DEFAULT TABLESPACE users
TEMPORARY TABLESPACE temp
QUOTA 10M ON users;

GRANT connect to ersproject;
GRANT resource to ersproject;
GRANT create session TO ersproject;
GRANT create table TO ersproject;
GRANT create view TO ersproject;

conn ersproject/ers0

CREATE TABLE REIMBURSTMENT_STATUS(
REIMB_STATUS_ID NUMBER(8) CONSTRAINT PK_REIMBURSTMENT_STATUS PRIMARY KEY,
REIMB_STATUS VARCHAR2(10)
);
CREATE TABLE REIMBURSTMENT_TYPE(
REIMB_TYPE_ID NUMBER(8)  CONSTRAINT PK_REIMBURSTMENT_TYPE PRIMARY KEY,
REIMB_TYPE VARCHAR2(10)
);
CREATE TABLE REIMBURSTMENT_USERS_ROLES(
REIMB_USERS_ROLE_ID NUMBER(8)  CONSTRAINT PK_USERS_ROLES PRIMARY KEY,
REIMB_USERS_ROLE VARCHAR2(20)
);

CREATE TABLE REIMBURSTMENT_USERS(
REIMB_USERS_ID NUMBER(8) CONSTRAINT PK_REIMBURSTMENT_USERS PRIMARY KEY,
REIMB_USERS_USERNAME VARCHAR(30) UNIQUE,
REIMB_USERS_PASSWORD VARCHAR(60),
REIMB_USERS_NAME VARCHAR2(50),
REIMB_USERS_EMAIL VARCHAR(64) UNIQUE, --POSSIBLE ENCRYPTION BUT MAYBE NOT
REIMB_USERS_ROLE_ID NUMBER(8),
CONSTRAINT FK_REIMB_USERS_ROLE FOREIGN KEY (REIMB_USERS_ROLE_ID)  REFERENCES REIMBURSTMENT_USERS_ROLES (REIMB_USERS_ROLE_ID));

CREATE TABLE REIMBURSTMENT(
REIMB_ID NUMBER(8) CONSTRAINT PK_REIMBURSTMENT PRIMARY KEY,
REIMB_AMOUNT NUMBER,
REIMB_SUBMIT TIMESTAMP,
REIMB_RESOLVED TIMESTAMP,
REIMB_DESCRIPTION VARCHAR(250),
REIMB_RECEIPT BLOB,
REIMB_RESOLVER_ID NUMBER(8),
REIMB_STATUS_ID NUMBER(8),
REIMB_TYPE_ID NUMBER(8),
REIMB_USERS_ID NUMBER(8),
CONSTRAINT FK_REIMB_RESOLVER_ID FOREIGN KEY (REIMB_RESOLVER_ID)  REFERENCES REIMBURSTMENT_USERS (REIMB_USERS_ID),
CONSTRAINT FK_REIMB_STATUS_ID FOREIGN KEY (REIMB_STATUS_ID)  REFERENCES REIMBURSTMENT_STATUS (REIMB_STATUS_ID),
CONSTRAINT FK_REIMB_TYPE_ID FOREIGN KEY (REIMB_TYPE_ID)  REFERENCES REIMBURSTMENT_TYPE (REIMB_TYPE_ID),
CONSTRAINT FK_REIMB_USERS_ID FOREIGN KEY (REIMB_USERS_ID)  REFERENCES REIMBURSTMENT_USERS (REIMB_USERS_ID));

CREATE SEQUENCE REIMB_STATUS_SEQ
    START WITH 10000000 
    INCREMENT BY 1;
    
CREATE SEQUENCE REIMB_TYPE_SEQ
    START WITH 10000000 
    INCREMENT BY 1; 
    
CREATE SEQUENCE REIMB_USERS_ROLES_SEQ
    START WITH 10000000 
    INCREMENT BY 1;    
    
CREATE SEQUENCE REIMB_USERS_SEQ
    START WITH 10000000 
    INCREMENT BY 1; 
    
CREATE SEQUENCE REIMB_SEQ
    START WITH 10000000 
    INCREMENT BY 1;  
    
CREATE OR REPLACE TRIGGER REIMB_USERS_ROLES_SEQ_TRG
BEFORE INSERT ON REIMBURSTMENT_USERS_ROLES 
FOR EACH ROW
BEGIN
    IF :new.REIMB_USERS_ROLE_ID = 0 THEN
    SELECT REIMB_USERS_ROLES_SEQ.nextval INTO :new.REIMB_USERS_ROLE_ID FROM dual;
    END IF;
END;
/

CREATE OR REPLACE TRIGGER REIMB_USERS_SEQ_TRG
BEFORE INSERT ON REIMBURSTMENT_USERS 
FOR EACH ROW
BEGIN
    IF :new.REIMB_USERS_ID = 0 THEN
    SELECT REIMB_USERS_SEQ.nextval INTO :new.REIMB_USERS_ID FROM dual;
    END IF;
END;
/

CREATE OR REPLACE TRIGGER REIMB_SEQ_TRG
BEFORE INSERT ON REIMBURSTMENT 
FOR EACH ROW
BEGIN
    IF :new.REIMB_ID = 0 THEN
    SELECT REIMB_SEQ.nextval INTO :new.REIMB_ID FROM dual;
    END IF;
END;
/

CREATE OR REPLACE TRIGGER REIMB_STATUS_SEQ_TRG
BEFORE INSERT ON REIMBURSTMENT_STATUS 
FOR EACH ROW
BEGIN
    IF :new.REIMB_STATUS_ID = 0 THEN
    SELECT REIMB_STATUS_SEQ.nextval INTO :new.REIMB_STATUS_ID FROM dual;
    END IF;
END; 
/

CREATE OR REPLACE TRIGGER REIMB_TYPE_SEQ_TRG
BEFORE INSERT ON REIMBURSTMENT_TYPE 
FOR EACH ROW
BEGIN
    IF :new.REIMB_TYPE_ID = 0 THEN
    SELECT REIMB_TYPE_SEQ.nextval INTO :new.REIMB_TYPE_ID FROM dual;
    END IF;
END;            
/

COMMIT;